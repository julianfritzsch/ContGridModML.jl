<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>General Implementation · ContGridModML</title><meta name="title" content="General Implementation · ContGridModML"/><meta property="og:title" content="General Implementation · ContGridModML"/><meta property="twitter:title" content="General Implementation · ContGridModML"/><meta name="description" content="Documentation for ContGridModML."/><meta property="og:description" content="Documentation for ContGridModML."/><meta property="twitter:description" content="Documentation for ContGridModML."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ContGridModML</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Implementation</span><ul><li><a class="tocitem" href="../finite/">Finite Element Method</a></li><li class="is-active"><a class="tocitem" href>General Implementation</a><ul class="internal"><li><a class="tocitem" href="#Ferrite"><span>Ferrite</span></a></li><li><a class="tocitem" href="#ContGridMod"><span>ContGridMod</span></a></li></ul></li><li><a class="tocitem" href="../static/">Learn Susceptances</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/public/">Public</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Internal</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/internal/dynamic/">Dynamic.jl</a></li><li><a class="tocitem" href="../../api/internal/static/">Static.jl</a></li><li><a class="tocitem" href="../../api/internal/tools/">Tools.jl</a></li><li><a class="tocitem" href="../../api/internal/mesh/">Mesh.jl</a></li><li><a class="tocitem" href="../../api/internal/init/">Initl.jl</a></li><li><a class="tocitem" href="../../api/internal/disc_dynamics/">Disc_dynamics.jl</a></li><li><a class="tocitem" href="../../api/internal/cont_dynamics/">Cont_dynamics.jl</a></li><li><a class="tocitem" href="../../api/internal/plot/">Plot.jl</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Implementation</a></li><li class="is-active"><a href>General Implementation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>General Implementation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/julianfritzsch/ContGridModML.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/julianfritzsch/ContGridModML.jl/blob/main/docs/src/implementation/general.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Notes-on-the-General-Implementation"><a class="docs-heading-anchor" href="#Notes-on-the-General-Implementation">Notes on the General Implementation</a><a id="Notes-on-the-General-Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Notes-on-the-General-Implementation" title="Permalink"></a></h1><p>In the following there are some general notes on the implementation of the continuous model using <a href="https://ferrite-fem.github.io/Ferrite.jl/"><code>Ferrite</code></a> and <a href="https://github.com/laurentpagnier/ContGridMod.jl"><code>ContGridMod</code></a>.</p><h2 id="Ferrite"><a class="docs-heading-anchor" href="#Ferrite">Ferrite</a><a id="Ferrite-1"></a><a class="docs-heading-anchor-permalink" href="#Ferrite" title="Permalink"></a></h2><p>In general <a href="https://ferrite-fem.github.io/Ferrite.jl/"><code>Ferrite</code></a> takes care of most things when it comes to keeping track of the degrees of freedom (nodal values) as well as calculating all the needed values of the base functions and its gradients. Additionally, it makes assembling the mass and stiffness matrix, and the force vector easy and allows finding the cells in which arbitrary points are located. The central element is the <a href="https://ferrite-fem.github.io/Ferrite.jl/stable/reference/dofhandler/#Ferrite.DofHandler"><code>DofHandler</code></a>. It keeps track of the different fields (<em>e.g.</em> <span>$\theta$</span> and <span>$\omega$</span>), contains the grid, and the order of the degrees of freedom.</p><div class="admonition is-danger"><header class="admonition-header">Danger</header><div class="admonition-body"><p>In general the degrees of freedom do NOT have the same order as the nodes of the grid. Ferrite loops over the cells in the grid and adds the degrees of freedom in the order it encounters them. For example if the first cell is made of nodes 40, 45, and 50, they will correspond to the degrees of freedom 1, 2, and 3. This is very important to keep in mind when trying to create matrices or to map result vectors onto the grid.</p></div></div><p>Another important structure is the <a href="https://ferrite-fem.github.io/Ferrite.jl/stable/reference/fevalues/#Ferrite.CellValues"><code>CellValues</code></a>. It contains the values of the base functions in the quadrature points as well as their gradients. The gradient values are automatically transformed to their proper values from their reference values. It also contains the product of the determinant of the Jacobian with the quadrature weight.</p><p>The final important structure is the <a href="https://ferrite-fem.github.io/Ferrite.jl/stable/reference/boundary_conditions/#Ferrite.ConstraintHandler"><code>ContraintHandler</code></a>. It allows us to enfoce Dirichlet boundary conditions whithout having to care about the degree of freedom ordering. It is used to enforce the slack bus and to create the initial condition vector for the dynamic simulations.</p><p>To learn more about how <a href="https://ferrite-fem.github.io/Ferrite.jl/"><code>Ferrite</code></a> can be used to assemble the different matrices, check out the <a href="https://ferrite-fem.github.io/Ferrite.jl/">Documentation</a>.</p><h2 id="ContGridMod"><a class="docs-heading-anchor" href="#ContGridMod">ContGridMod</a><a id="ContGridMod-1"></a><a class="docs-heading-anchor-permalink" href="#ContGridMod" title="Permalink"></a></h2><p><a href="https://github.com/laurentpagnier/ContGridMod.jl"><code>ContGridMod</code></a> offers data structures for continious and discrete models as well as some utilities. The discrete model is used for the ground truth model. Its dyanmics are governed by</p><p class="math-container">\[\begin{align*}
m_i \ddot{\theta}_i + d_i \dot{\theta}_i = P_i - \sum_j b_{ij}\sin(\theta_i - \theta_j), &amp;\quad\text{for } i \in \text{generator},\\
d_i \dot{\theta}_i = P_i - \sum_j b_{ij}\sin(\theta_i - \theta_j),&amp;\quad\text{for } i \in \text{load }.\\
\end{align*}\]</p><h3 id="Structures"><a class="docs-heading-anchor" href="#Structures">Structures</a><a id="Structures-1"></a><a class="docs-heading-anchor-permalink" href="#Structures" title="Permalink"></a></h3><h4 id="Discrete-Model"><a class="docs-heading-anchor" href="#Discrete-Model">Discrete Model</a><a id="Discrete-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-Model" title="Permalink"></a></h4><p>The <code>DiscModel</code> struct provides the following fields:</p><ul><li><code>m_gen</code> inertia of each generator</li><li><code>d_gen</code> damping of each generator</li><li><code>id_gen</code> IDs of each generator</li><li><code>id_slack</code> ID of the slack bus</li><li><code>coord</code> the coordinates of each bus. They are ordered as (longitude, latitude). The coordinates have been transformed using an Albers Projection and afterwards scaled   by the same factor as the continuous grid such that the longest dimension has length 1.</li><li><code>d_load</code> damping of each load buses</li><li><code>id_line</code> matrix containing the lines. They are sorted as (start, end)</li><li><code>b</code> line suscepetances</li><li><code>p_load</code> consumption of each node</li><li><code>th</code> steady state solution</li><li><code>p_gen</code> power generation of each generator. If the <code>p_gen</code> = 0. The generator is inactive.</li><li><code>max_gen</code> maximum generation of each generator</li><li><code>Nbus</code> number of buses</li><li><code>Ngen</code> number of generators</li><li><code>Nline</code> number of lines</li></ul><h4 id="Continuous-Model"><a class="docs-heading-anchor" href="#Continuous-Model">Continuous Model</a><a id="Continuous-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-Model" title="Permalink"></a></h4><p>The <code>ContModel</code> struct provides the following fields:</p><ul><li><code>grid</code> GMSH grid of the continuous model</li><li><code>dh₁</code> DofHandler containing one field <code>:u</code>. Used for the stable solution and to obtain field values.</li><li><code>dh₂</code> DofHandler containing two fields <code>:θ</code> and <code>:ω</code>. Used for the dynamical simulations.</li><li><code>cellvalues</code> CellValues object for the two DofHandlers</li><li><code>area</code> area of the grid used for normalization</li><li><code>m_nodal</code> nodal values for the inertia</li><li><code>d_nodal</code> nodal values for the damping</li><li><code>p_nodal</code> nodal values for the power</li><li><code>bx_nodal</code> nodal values for the <span>$x$</span> component of the susceptance</li><li><code>by_nodal</code> nodal values for the <span>$y$</span> component of the susceptance</li><li><code>θ₀_nodal</code> nodal values for the steady state solution</li><li><code>fault_nodal</code> nodal values for the power fault</li><li><code>m</code> function returning inertia at point <code>x</code></li><li><code>d</code> function returning damping at point <code>x</code></li><li><code>p</code> function returning power at point <code>x</code></li><li><code>bx</code> function returning <span>$x$</span> component of the susceptance at point <code>x</code></li><li><code>by</code> function returning <span>$y$</span> component of the susceptance at point <code>x</code></li><li><code>θ₀</code> function returning steady state solution at point <code>x</code></li><li><code>fault</code> function returning the power fault at point <code>x</code></li><li><code>ch</code> ConstraintHandler to enforce the slack bus</li></ul><h4 id="Creating-Models"><a class="docs-heading-anchor" href="#Creating-Models">Creating Models</a><a id="Creating-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-Models" title="Permalink"></a></h4><p>To create the models from scratch, we first need to load a grid. The grid can be created from a polygon. The corners of the polygon need to be placed in a JSON file with the following structure</p><pre><code class="language-json hljs">{
    &quot;border&quot;: [[x0, y0],
                [x1, y1],
                ...
              ]
}</code></pre><p>The file is then loaded, the Albers projection applied, rescaled, and turned into a GMSH grid as follows (<code>dx</code> is the mesh element size)</p><pre><code class="language-julia-repl hljs">julia&gt; using ContGridMod
julia&gt; grid, scale_factor = get_grid(file_name, dx)</code></pre><p>Alternatively, one can also directly load an existing GMSH file with the same command.</p><p>Next the discrete model can be loaded from a HDF5 file. The data in the HDF5 file needs to contain the grid in the Matpower Data format with the additional data fields defined in the original <a href="https://zenodo.org/record/2642175">PanTaGruEl model</a>. If you want to know more you can investigate the included scenarios in the <code>data/ml</code> folder of this repository.</p><pre><code class="language-julia-repl hljs">julia&gt; dm = load_discrete_model(file_name, scale_factor)</code></pre><p>Finally, the continuous model can be created using the grid and the discrete model. The parameters are distributed using a heat equation diffusion.</p><pre><code class="language-julia-repl hljs">julia&gt; cm = get_params(grid, 0.05, dm, κ=0.02, bfactor=50000.0, σ=0.01, bmin=1)</code></pre><p>Faults in the discrete model can be simulated by</p><pre><code class="language-julia-repl hljs">julia&gt; sol = disc_dynamics(dm, t0, tf, dP, faultid=id)</code></pre><p>For faults in the continuous model we first need to calculate the steady state solution, then create the fault, and finally run the simulation</p><pre><code class="language-julia-repl hljs">julia&gt; stable_sol!(cm)
julia&gt; add_local_disturbance!(cm, coords, dP, σ)
julia&gt; sol = perform_dyn_sim(cm, t0, tf)</code></pre><p>The models can easily be saved as HDF5 file and loaded</p><pre><code class="language-julia-repl hljs">julia&gt; save_model(file_name, model)
julia&gt; model = load_model(file_name)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../finite/">« Finite Element Method</a><a class="docs-footer-nextpage" href="../static/">Learn Susceptances »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 24 January 2024 10:56">Wednesday 24 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
